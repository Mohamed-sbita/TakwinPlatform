<div class="container-fluid py-4">
    <div class="card shadow-sm">
      <div class="card-header bg-white border-bottom-0 py-3">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 fw-semibold">
            <i class="bx bx-list-check me-2"></i> Demandes d'attestation
          </h4>
          <div class="d-flex gap-2">
            <div class="input-group" style="width: 250px;">
              <span class="input-group-text bg-white">
                <i class="bx bx-search"></i>
              </span>
              <input 
                type="text" 
                class="form-control" 
                placeholder="Rechercher..." 
                [(ngModel)]="searchTerm" 
                (input)="filterAttestations()">
            </div>
            <select 
              class="form-select" 
              style="width: 150px;"
              [(ngModel)]="statusFilter" 
              (change)="filterAttestations()">
              <option value="all">Tous les statuts</option>
              <option value="pending">En attente</option>
              <option value="approved">Approuvées</option>
              <option value="rejected">Rejetées</option>
            </select>
          </div>
        </div>
      </div>
  
      <div class="card-body p-0">
        <div *ngIf="isLoading" class="text-center py-5">
          <div class="spinner-border text-primary"></div>
          <p class="mt-2">Chargement en cours...</p>
        </div>
  
        <div *ngIf="error" class="alert alert-danger mx-3 mt-3">
          {{ error }}
        </div>
  
        <div *ngIf="!isLoading && filteredAttestations.length === 0" class="text-center py-5">
          <i class="bx bx-file-blank fs-1 text-muted"></i>
          <p class="mt-2 text-muted">Aucune demande trouvée</p>
        </div>
  
        <div *ngIf="!isLoading && filteredAttestations.length > 0" class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Stagiaire</th>
                <th>Date demande</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let att of paginatedAttestations">
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-sm bg-light rounded-circle d-flex align-items-center justify-content-center me-2">
                      <i class="bx bx-user fs-5"></i>
                    </div>
                    <div>
                      <div class="fw-medium">{{ att.stagiaire.prenom }} {{ att.stagiaire.nom }}</div>
                      <small class="text-muted">Classe : {{ att.stagiaire.idClasse?.nom || 'Classe non spécifiée' }}</small>
                      <small class="text-muted d-block">
                        Département : {{ att.stagiaire.idClasse?.idDepartment?.nom || 'Département inconnu' }}
                      </small>
                    </div>
                  </div>
                </td>
                <td>{{ att.requestedAt | date:'mediumDate' }}</td>
                <td>
                  <span class="badge rounded-pill" 
                        [ngClass]="{
                          'bg-warning': att.status === 'pending',
                          'bg-success': att.status === 'approved',
                          'bg-danger': att.status === 'rejected'
                        }">
                    {{ att.status === 'pending' ? 'En attente' : 
                       att.status === 'approved' ? 'Approuvée' : 'Rejetée' }}
                  </span>
                </td>
                <td>
                  <div class="d-flex gap-2">
                    <button *ngIf="att.status === 'pending'" 
                            (click)="updateStatus(att._id, 'approved')"
                            class="btn btn-sm btn-success">
                      <i class="bx bx-check"></i> Approuver
                    </button>
                    <button 
                            (click)="updateStatus(att._id, 'rejected')"
                            class="btn btn-sm btn-danger">
                      <i class="bx bx-x"></i> Rejeter
                    </button>
                   
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
  
        <div *ngIf="filteredAttestations.length > itemsPerPage" class="card-footer bg-white border-top-0">
          <nav>
            <ul class="pagination justify-content-center mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" (click)="currentPage = currentPage - 1">
                  <i class="bx bx-chevron-left"></i>
                </a>
              </li>
              <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" 
                  [class.active]="currentPage === i + 1">
                <a class="page-link" (click)="currentPage = i + 1">{{ i + 1 }}</a>
              </li>
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <a class="page-link" (click)="currentPage = currentPage + 1">
                  <i class="bx bx-chevron-right"></i>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>