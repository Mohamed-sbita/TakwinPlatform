<div class="users-container">
  <div class="header-section">
    <div class="header-content">
      <h1 class="header-title">Gestion des Utilisateurs</h1>
      <p class="header-subtitle">Administrez tous les utilisateurs du système</p>
    </div>
    <button class="create-btn" [routerLink]="['/dashboard/utilisateur/create']">
      <svg viewBox="0 0 24 24">
        <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
      </svg>
      Ajouter un utilisateur
    </button>
  </div>

  <!-- Section Filtres -->
  <div class="filter-section row d-flex align-items-start">
    <div class="search-container col-md-6">
      <svg class="search-icon" viewBox="0 0 24 24">
        <path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
      </svg>
      <input type="text" [(ngModel)]="searchTerm" (input)="applyFilters()" 
             placeholder="Rechercher par nom, email ou code..." class="search-input">
    </div>

    <div class="filter-controls col-md-6">
      <select [(ngModel)]="selectedRole" (change)="applyFilters()" class="filter-select">
        <option *ngFor="let role of roles" [value]="role">{{role | titlecase}}</option>
      </select>
      <select [(ngModel)]="itemsPerPage" (change)="currentPage = 1" class="filter-select">
        <option value="5">5 par page</option>
        <option value="10">10 par page</option>
        <option value="20">20 par page</option>
        <option value="50">50 par page</option>
      </select>
    </div>
  </div>

  <!-- État de Chargement -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des utilisateurs...</p>
  </div>

  <!-- État Vide -->
  <div *ngIf="!isLoading && filteredUsers.length === 0" class="empty-state">
    <svg class="empty-icon" viewBox="0 0 24 24">
      <path fill="currentColor" d="M12,3C16.97,3 21,7.03 21,12C21,16.97 16.97,21 12,21C7.03,21 3,16.97 3,12C3,7.03 7.03,3 12,3M12,8C11.45,8 11,8.45 11,9V13C11,13.55 11.45,14 12,14C12.55,14 13,13.55 13,13V9C13,8.45 12.55,8 12,8M11,15V17H13V15H11Z" />
    </svg>
    <h3>Aucun utilisateur trouvé</h3>
    <p>Essayez d'ajuster vos filtres ou créez un nouvel utilisateur</p>
    <button class="empty-action-btn" [routerLink]="['/dashboard/utilisateur/create']">
      Créer un utilisateur
    </button>
  </div>

  <!-- Tableau des Utilisateurs -->
  <div *ngIf="!isLoading && filteredUsers.length > 0" class="users-table-container">
    <div class="table-responsive">
      <table class="users-table">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Email</th>
            <th>Code</th>
            <th>Rôle</th>
            <th>Téléphone</th>
            <th>Date de naissance</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of paginatedUsers">
            <td>
              <div class="user-info">
                <div class="user-avatar">
                  <img [src]="'http://127.0.0.1:3000/files/' + user.image" alt="Avatar utilisateur" onerror="this.src='http://127.0.0.1:3000/uploads/admin.png'">
                </div>
                <div class="user-name">{{user.nom}} {{user.prenom}}</div>
              </div>
            </td>
            <td>{{user.email}}</td>
            <td>{{user.codeInscription || 'N/A'}}</td>
            <td>
              <span class="badge" [ngClass]="getRoleBadgeClass(user.role)">{{user.role | titlecase}}</span>
            </td>
            <td>{{user.tel || 'N/A'}}</td>
            <td>{{formatDate(user.dateNaissance)}}</td>
            <td>
              <div class="action-buttons">
                <button class="edit-btn" [routerLink]="['/dashboard/utilisateur/edit', user._id]" title="Modifier">
                  <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
                  </svg>
                </button>
                <button class="delete-btn" (click)="deleteUser(user._id)" title="Supprimer">
                  <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1" title="Précédent">
        <svg viewBox="0 0 24 24">
          <path fill="currentColor" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z" />
        </svg>
      </button>
      
      <button *ngFor="let page of [].constructor(totalPages); let i = index" 
              (click)="changePage(i + 1)" 
              [class.active]="currentPage === i + 1">
        {{i + 1}}
      </button>
      
      <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages" title="Suivant">
        <svg viewBox="0 0 24 24">
          <path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" />
        </svg>
      </button>
    </div>
  </div>
</div>